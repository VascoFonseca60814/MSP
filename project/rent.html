<!DOCTYPE html>
<html lang="pt">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Rent Elegance</title>
  <link rel="icon" type="image/x-icon" href="res/icon.ico">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet"
    integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous">
  <link rel="stylesheet"
    href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-datepicker/1.9.0/css/bootstrap-datepicker.min.css">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/bbbootstrap/libraries@main/choices.min.css">

  <link rel="stylesheet" type="text/css" href="./css/animations.css" />
  <link rel="stylesheet" type="text/css" href="./css/styles.css" />
</head>

<body>
  <nav class="autohide navbar navbar-expand navbar-dark fixed-top " aria-label="Second navbar example">
    <div class="container">

      <a class="navbar-brand fadein" href="./catalog.html">
        <img src="./res/icon.png" alt="" width="40" height="40" class="d-inline-block align-text-top">
      </a>

      <div class="navbar-collapse d-flex justify-content-start fadein d-none d-md-block">
        <ul class="navbar-nav ml-auto d-flex align-items-center d-none d-md-block">
          <li class="nav-item">
            <text class="title navbar-brand text-uppercase">Rent Elegance</text>
          </li>
        </ul>
      </div>

      <div class="navbar-collapse d-flex justify-content-end slidein">
        <ul class="navbar-nav d-flex align-items-center ">
          <li class="nav-item ml-xs-5 ms-4">
            <a href="./catalog.html"> <i class="fa-solid fa-house text-white h3 m-2 scale-2"></i> </a>
          </li>
          <li class="nav-item ml-xs-5 ms-4">
            <a href="./ListofFavorites.html"> <i class="fa-regular fa-heart text-white h3 m-2 scale-2"></i> </a>
          </li>
          <li class="nav-item ms-4">
            <a href="./createVenue.html" class="btn btn-add-venue m-2 scale-1 d-none d-md-block">
              <text class="main-buttons h6">Adicionar Venue</text> <i class="fa fa-plus"></i>
            </a>
          </li>
          <li class="nav-item ms-4">

            <div class="dropdown">
              <a type="button" data-bs-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                <img class="rounded-circle shadow-4-strong scale-1" src="./res/profile.jpg" width="50" height="50" />
              </a>
              <div class="dropdown-menu dropdown-menu-end rounded-1 p-3">
                <a class="dropdown-item" href="./PersonalArea.html"><i class="fa-solid fa-user me-3"></i>Perfil</a>
                <a class="dropdown-item" href="./ListofFavorites.html"><i
                    class="fa-regular fa-heart me-3"></i>Favoritos</a>
                <a class="dropdown-item" href="./listReservations.html"><i
                    class="fa-regular fa-clipboard me-3"></i>Reservas</a>
                <a class="dropdown-item" href="./ListVenues.html"><i class="fa-solid fa-house me-3"></i>Minhas
                  venues</a>
                <div class="dropdown-divider"></div>
                <a class="dropdown-item" href="#"><i class="fa fa-sign-out me-3"></i> Sair</a>
              </div>
            </div>

          </li>
        </ul>
      </div>

    </div>
  </nav>



  <div class="content container p-5 pt-0">
    <div class="row shadow-div shadow p-5">
      <form id="rent" class="row needs-validation mt-0" novalidate>

        <div class="col-12">

          <div class="">
            <h2 class="text-white ">Faça a sua reserva</h2>
            <hr class="bg-white  mt-2 mb-2">
            <h6 class="text-white">Especifique as suas necessiades e faça a sua reserva</h6>
          </div>
        </div>

        <div class="col-lg-6 col-12 pt-2">

          <div class="row pt-0">

            <div class="col-md-12">
              <label class="form-label text-white required">Nome do evento</label>
              <input type="text" name="event-name" class="form-control" required>
            </div>
            <div class="col-md-12">
              <label class="form-label text-white">Empresa</label>
              <input type="text" name="company" class="form-control">
            </div>
            <div class="col-md-6">
              <label class="form-label text-white required">Datas</label>

              <div class="input-group" onclick="$('#date').datepicker('show')">
                <div class="input-group-text"> <i class="fa-solid fa-calendar-days"></i></div>
                <input type="text" class="form-control" id="date" name="dates" onkeydown="return false"
                  autocomplete="off" required>
              </div>
            </div>

            <div class="col-md-6">
              <label class="form-label text-white required">Nº de convidados</label>
              <input type="number" class="form-control" name="guests" max="1000" min="1" required>
            </div>

            <div class="col-md-12">
              <label class="form-label text-white">Serviços</label>

              <div class="multiple-select">
                <select id="comodidades-multiple" placeholder="Selecionar" style="display: none !important;" multiple>
                  <option value="Bar">300.00 €</option>
                  <option value="Iluminação">69,99 €</option>
                  <option value="Catering">679.99 €</option>
                  <option value="Fotógrafo">245.00 €</option>

                </select>
              </div>


            </div>


            <div class="col-md-12">
              <label for="exampleFormControlTextarea1" class="form-label text-white">Informação extra</label>
              <textarea class="form-control" id="exampleFormControlTextarea1" name="extra" rows="4"></textarea>
            </div>

            <div class="col-12">
              <div class="form-check">
                <input class="form-check-input" type="checkbox" value="" id="invalidCheck" required>
                <label class="form-check-label text-white" for="invalidCheck">
                  Aceitar os termos e condições
                </label>
                <div class="invalid-feedback">
                  Para prosseguir voce tem que aceitar os termos e condições!
                </div>
              </div>
            </div>

          </div>
        </div>

        <div class="col-lg-6 col-12 p-2">
          <div class="p-5 shadow-div shadow">
            <img src="./res/venue.jpg" alt="" class=" w-100 shadow-5 rounded cover">

            <div class="p-4">


              <table id="summary" class="table table-borderless text-white mb-0"
                style="white-space: nowrap !important;">
                <thead>
                  <tr style="border-bottom: solid 1px white;">
                    <th scope="col">Serviço</th>
                    <th scope="col" class="text-end" style="width: 25%"><i class="fa-solid fa-euro-sign"></i></th>
                  </tr>
                </thead>
                <tbody>
                  <tr style="border-top: solid 1px white;">
                    <td class="text-end">Total</td>
                    <td class="text-end">0 €</td>
                  </tr>
                </tbody>
              </table>
            </div>


            <div class="d-flex justify-content-center">
              <button class="btn btn-primary p-2 w-50 text-uppercase" type="submit">
                Reservar
              </button>
            </div>

          </div>
        </div>

        <div class="modal fade" id="confirmation" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel"
          aria-hidden="true">
          <div class="modal-dialog" role="document">
            <div class="modal-content">
              <div class="modal-header">
                <h5 class="modal-title" id="exampleModalLabel">Confirmar o pedido de reserva</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
              </div>
              <div class="modal-body">
                O seu pedido será enviado ao proprietário da venue.
                <br>
                Será notificado pelo mesmo num prazo de 10 dias úteis para confirmar os detalhes da sua reserva.
                <br>
                Pretende confirmar esta ação?
              </div>
              <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button>
                <button class="btn btn-primary p-2 w-50" type="button" onclick="submitRent()">Confirmar</button>
              </div>
            </div>
          </div>
        </div>

      </form>
    </div>
  </div>

  <footer class="py-4 text-center text-md-start">

    <div class="container">
      <div class="row">
        <div class="col-md-4 col-12">
          <div class="d-flex justify-content-center  justify-content-md-start p-4 p-md-0">

            <ul class="nav flex-column">
              <h4 class="text-white">Contactos</h4>
              <li class="nav-item mb-2 text-white"><i class="fa-solid fa-house me-2"></i>Universidade Nova FCT</li>
              <li class="nav-item mb-2 text-white"><i class="fa-solid fa-phone me-2"></i>+(351) 213 131 231</li>
              <li class="nav-item mb-2 text-white"><i class="fa-solid fa-envelope me-2"></i>geral@rentelegance.pt</li>
            </ul>
          </div>
        </div>

        <div class="col-md-4 col-12">
          <div class="d-flex justify-content-center justify-content-md-start p-4 p-md-0">
            <ul class="nav flex-column">

              <h4 class="text-white ">Redes Sociais</h4>

              <ul class="nav list-inline">
                <li class="btn btn-social"><i class="fab fa-facebook-f"></i></li>
                <li class="btn btn-social"><i class="fab fa-twitter"></i></li>
                <li class="btn btn-social"><i class="fab fa-linkedin-in"></i></li>
                <li class="btn btn-social"><i class="fab fa-whatsapp"></i></li>

              </ul>
            </ul>
          </div>
        </div>

        <div class="col-md-4 col-12">
          <div class="d-flex justify-content-center justify-content-md-start p-4 p-md-0">
            <form>
              <h4 class="text-white">Subscreva a nossa newsletter</h4>
              <p class="text-white">Seja o primeiro a receber as novidades.</p>
              <div class="d-flex w-100 gap-2">
                <label for="newsletter1" class="visually-hidden">Endereço de email</label>
                <input id="newsletter1" type="text" class="form-control" placeholder="Endereço de email">
                <button class="btn btn-subscribe text-white" type="button">Subscrever</button>
              </div>
            </form>
          </div>
        </div>
      </div>
    </div>


  </footer>
  <div class="copyright">
    <div class="text-center text-white p-1">© 2023 Copyright IMP Classes</div>
  </div>


  <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.11.8/dist/umd/popper.min.js"
    integrity="sha384-I7E8VVD/ismYTF4hNIPjVp/Zjvgyol6VFvRkX/vR+Vc4jQkC+hVqc2pM8ODewa9r"
    crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.min.js"
    integrity="sha384-BBtl+eGJRgqQAUMxJ7pMwbEyER4l1g+O15P+16Ep7Q9Q+zqX6gSbd85u4mG4QzX+"
    crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/gh/bbbootstrap/libraries@main/choices.min.js"></script>

  <script src="https://kit.fontawesome.com/77b73da3f6.js" crossorigin="anonymous"></script>
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.16.0/umd/popper.min.js"></script>
  <script
    src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-datepicker/1.9.0/js/bootstrap-datepicker.min.js"></script>

  <!--<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.1.1/js/bootstrap.bundle.min.js"></script>-->


  <script type='text/javascript' src='./javascript/java.js'></script>

  <script>

    (function () {
      'use strict'

      // Fetch all the forms we want to apply custom Bootstrap validation styles to
      var forms = document.querySelectorAll('.needs-validation')

      // Loop over them and prevent submission
      Array.prototype.slice.call(forms)
        .forEach(function (form) {
          form.addEventListener('submit', function (event) {
            if (!form.checkValidity()) {
              event.preventDefault()
              event.stopPropagation()
            }

            form.classList.add('was-validated')


          }, false)
        })
    })()

    $(document).ready(function () {
      var multipleCancelButton = new Choices('#comodidades-multiple', {
        removeItemButton: true,
        searchResultLimit: 5,
        itemSelectText: "",
        noChoicesText: "Sem resultados",
        noResultsText: "Resultado não encontrado"
      });
    });

    $('#comodidades-multiple').change(function () {
      updateTable()
    })

    $('#date').on("changeDate", function (event) {
      updateTable()
    });

    function updateTable() {
      let total = 0
      $("#summary").find("tr:gt(0)").remove();
      $('#comodidades-multiple  option:selected').each(function () {
        let price = parseFloat($(this).text().replace(" €", ""))
        $('#summary tr:last').after('<tr><td>' + $(this).val() + '</td><td class="text-end">' + price + ' €</td></tr>');
        total += price;
      });

      let days = getDays($('#date'))
      const pricePerDay = 1500
      let price = pricePerDay * days;

      if (days >= 1) 
        $('#summary tr:last').after('<tr style="border-top: solid 1px white;"><td class="text-end">Espaço </td><td class="text-end">' + (pricePerDay * days) + ' €</td></tr>');
      

        total += price
      $('#summary tr:last').after('<tr style="border-top: solid 1px white;"><td class="text-end">Total</td><td class="text-end">' + total + ' €</td></tr>');


    }

    $('#rent').on('submit', function (event) {
      if (this.checkValidity() === false) {
        event.preventDefault();
        event.stopPropagation();
        return;
      }

      event.preventDefault();
      event.stopPropagation();

      $('#confirmation').modal('show')
    });

    function getDays(datepicker) {
      let array =  datepicker.data("selecteddates").split(',')
      if(array.length == 0)
        return 0;

      var startDate = new Date(array[0]);
      var endDate = new Date(array[array.length-1]);

      if (startDate != null && startDate == endDate) {
        return 1
      }
      else if (startDate && endDate) {
        var timeDiff = endDate.getTime() - startDate.getTime();
        var daysDiff = Math.ceil(timeDiff / (1000 * 3600 * 24));
        return daysDiff + 1
      } else {
        return 0
      }
    }

    function submitRent() {
      const jsonObject = {};
      $.each($('#rent').serializeArray(), function () {
        jsonObject[this.name] = this.value;
      });

      jsonObject["amenities"] = $('#comodidades-multiple option:selected').map(function () { return $(this).val(); }).get();

      showSpinner()
      setTimeout(function () {
        const randomBoolean = Math.random() < 0.5;

        hideSpinner();
        $('#confirmation').modal('hide')

        if (randomBoolean > 0.5) { //Success
          formModified = false;
          redirect({ rented: 'true' }, "listReservations.html");
        }
        else //Failure
          createFailureToast(5000, "Falha ao enviar o pedido!")

      }, 2000);
    }

    //Form Stuff
    const form = document.getElementById('rent');
    const formInputs = form.querySelectorAll('input');
    const formSelects = form.querySelectorAll('select');

    let formModified = false;

    formInputs.forEach(input => {
      input.addEventListener('input', function () {
        formModified = true;
      });
    });

    formSelects.forEach(select => {
      select.addEventListener('change', function () {
        formModified = true;
      });
    });

    window.addEventListener('beforeunload', function (event) {
      if (formModified) {
        event.preventDefault();
        event.returnValue = 'You have unsaved changes. Are you sure you want to leave?';
      }
    });

    $(document).ready(function () {
      $('.choices__input').addClass('form-control');
      $('.choices__input').prop('required', true);

      $('select.choices__input').change(function () {
        let input = $(this).parent().children("input")[0];


        if ($(this)[0].length > 0) {
          $(input).removeClass("is-invalid")
          $(input).prop('required', false);
        }
        else {
          $(input).prop('required', true);
        }

      });
    });
  </script>
</body>

</html>